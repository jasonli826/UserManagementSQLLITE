<UserControl x:Class="UserManagementLibray.RoleSequenceControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:local="clr-namespace:UserManagementLibray"
             mc:Ignorable="d">
    <UserControl.Resources>
        <ResourceDictionary>
            <Style TargetType="TreeView">
                <Setter Property="Background" Value="White"/>
                <Setter Property="BorderBrush" Value="#DDD"/>
                <Setter Property="BorderThickness" Value="1"/>
                <Setter Property="Padding" Value="5"/>
                <Setter Property="FontFamily" Value="Segoe UI"/>
                <Setter Property="FontSize" Value="14"/>
            </Style>

            <Style TargetType="TreeViewItem">
                <Setter Property="Background" Value="Transparent"/>
                <Setter Property="BorderBrush" Value="Transparent"/>
                <Setter Property="BorderThickness" Value="1"/>
                <Setter Property="Margin" Value="2"/>
                <Setter Property="Padding" Value="4"/>
                <Setter Property="FontFamily" Value="Segoe UI"/>
                <Setter Property="FontSize" Value="14"/>
                <Setter Property="Foreground" Value="#333"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="TreeViewItem">
                            <Grid>
                                <Border x:Name="Bd"
                            Background="{TemplateBinding Background}"
                            BorderBrush="{TemplateBinding BorderBrush}"
                            BorderThickness="{TemplateBinding BorderThickness}"
                            CornerRadius="4">
                                    <StackPanel Orientation="Horizontal">
                                        <ToggleButton x:Name="Expander"
                                          IsChecked="{Binding IsExpanded, RelativeSource={RelativeSource TemplatedParent}}"
                                          ClickMode="Press"
                                          Focusable="False"
                                          Width="16" Height="16"
                                          Margin="2">
                                            <Path x:Name="ExpanderIcon"
                                      Data="M 0 0 L 4 4 L 8 0 Z"
                                      Fill="#888"
                                      Stretch="Uniform"/>
                                        </ToggleButton>
                                        <ContentPresenter x:Name="PART_Header"
                                              ContentSource="Header"
                                              Margin="4,0,0,0"/>
                                    </StackPanel>
                                </Border>
                            </Grid>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter TargetName="Bd" Property="Background">
                                        <Setter.Value>
                                            <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                                <GradientStop Color="#A7C7E7" Offset="0.0"/>
                                                <GradientStop Color="#6DA1D5" Offset="1.0"/>
                                            </LinearGradientBrush>
                                        </Setter.Value>
                                    </Setter>
                                    <Setter Property="Foreground" Value="White"/>
                                </Trigger>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="Bd" Property="Background">
                                        <Setter.Value>
                                            <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                                <GradientStop Color="#E3F2FD" Offset="0.0"/>
                                                <GradientStop Color="#BBDEFB" Offset="1.0"/>
                                            </LinearGradientBrush>
                                        </Setter.Value>
                                    </Setter>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="../Style/UserControlStyles.xaml"/>
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </UserControl.Resources>

    <Grid Margin="10">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="300" />
            <!-- TreeView -->
            <ColumnDefinition Width="Auto" />
            <!-- Toolbar -->
        </Grid.ColumnDefinitions>

        <!-- TreeView Container -->
        <Border Grid.Column="0" BorderBrush="Gray" BorderThickness="1" CornerRadius="5" Padding="5">
            <TreeView x:Name="RoleTreeView"
                      SelectedItemChanged="RoleTreeView_SelectedItemChanged"
                      PreviewMouseLeftButtonDown="RoleTreeView_PreviewMouseLeftButtonDown"
                      PreviewMouseMove="RoleTreeView_PreviewMouseMove"
                      AllowDrop="True"
                      Drop="RoleTreeView_Drop">
                <TreeView.ItemTemplate>
                    <HierarchicalDataTemplate ItemsSource="{Binding Children}">
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="{Binding Role_Name}" FontWeight="Bold" Margin="2"/>
                        </StackPanel>
                    </HierarchicalDataTemplate>
                </TreeView.ItemTemplate>
                <TreeView.ItemContainerStyle>
                    <Style TargetType="TreeViewItem">
                        <Setter Property="IsExpanded" Value="{Binding IsExpanded}" />
                    </Style>
                </TreeView.ItemContainerStyle>
            </TreeView>
        </Border>

        <!-- Toolbar -->
        <StackPanel Grid.Column="1" Orientation="Vertical" VerticalAlignment="Top" Margin="10,0,0,0" Style="{StaticResource ToolbarPanel}">
            <Button Content="▲ Move Up" Click="MoveUp_Click" Margin="5" Width="100" ToolTip="Move selected role up" />
            <Button Content="▼ Move Down" Click="MoveDown_Click" Margin="5" Width="100" ToolTip="Move selected role down" />
            <Button Content="💾 Save" Click="Save_Click" Margin="5" Width="100" ToolTip="Save role sequence changes" />
        </StackPanel>
    </Grid>
</UserControl>
