<UserControl x:Class="UserManagementlibrary.Alarm"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:lvc="clr-namespace:LiveCharts.Wpf;assembly=LiveCharts.Wpf"
             xmlns:sys="clr-namespace:System;assembly=mscorlib"
             mc:Ignorable="d"
             Background="#F3F6FB">

    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="../Style/UserControlStyles.xaml"/>
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </UserControl.Resources>

    <Grid Margin="20">
        <TabControl SelectionChanged="TabControl_SelectionChanged">
            <!-- Tab 1: Alarm Management -->
            <TabItem Header="Alarm Management" FontSize="18"
                     Tag="{StaticResource AlarmTabColor}">
                <TabItem.HeaderTemplate>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                            <TextBlock Text=""
                                       FontFamily="Segoe MDL2 Assets"
                                       FontSize="16"
                                       Foreground="{StaticResource AlarmTabColor}"
                                       Margin="0,0,6,0"/>
                            <TextBlock Text="Alarm Management"/>
                        </StackPanel>
                    </DataTemplate>
                </TabItem.HeaderTemplate>
                <Grid Margin="20">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Title -->
                    <TextBlock Text="🚨 Alarm Management" FontSize="18" FontWeight="Bold" Foreground="{StaticResource PrimaryColor}" Margin="0 0 0 10"/>

                    <!-- Filters -->
                    <Border Grid.Row="1"
                            Background="White"
                            CornerRadius="10"
                            Padding="15"
                            BorderBrush="{StaticResource BorderColor}"
                            BorderThickness="1"
                            Margin="0 0 0 15">
                        <StackPanel Orientation="Horizontal">
                            <StackPanel Width="150">
                                <TextBlock Text="Start Date" VerticalAlignment="Center" Foreground="{StaticResource PrimaryColor}" FontWeight="Bold" />
                                <DatePicker x:Name="dpStartDate" SelectedDateFormat="Short" DisplayDateEnd="{x:Static sys:DateTime.Today}"/>
                            </StackPanel>

                            <StackPanel Width="150" Margin="20,0,0,0">
                                <TextBlock Text="End Date" VerticalAlignment="Center" Foreground="{StaticResource PrimaryColor}" FontWeight="Bold" />
                                <DatePicker x:Name="dpEndDate" SelectedDateFormat="Short" DisplayDateEnd="{x:Static sys:DateTime.Today}"/>
                            </StackPanel>

                            <StackPanel Margin="30,0,0,0">
                                <TextBlock Text="Keyword" VerticalAlignment="Center" Foreground="{StaticResource PrimaryColor}" FontWeight="Bold"/>
                                <TextBox x:Name="txtKeyword" Height="52" VerticalAlignment="Top" HorizontalAlignment="Left" Width="450" TextWrapping="Wrap" KeyDown="txtKeyword_Keydown" />
                            </StackPanel>

                            <StackPanel Orientation="Horizontal" VerticalAlignment="Bottom" Margin="20,0,0,0">
                                <Button Content="Search" Width="100" Click="SearchButton_Click"/>
                                <Button Content="Clear" Width="100" Click="RefreshButton_Click"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>

                    <!-- DataGrid -->
                    <DataGrid x:Name="dgAlarms" IsReadOnly="True" Grid.Row="2" AutoGenerateColumns="False" Margin="10" CanUserAddRows="False"  RowHeight="40"
                     FontSize="16" RowBackground="White" AlternatingRowBackground="#F9FBFF" BorderBrush="{StaticResource PrimaryColor}"
                     BorderThickness="1" GridLinesVisibility="None" HeadersVisibility="Column" HorizontalGridLinesBrush="#E0E0E0" VerticalGridLinesBrush="#E0E0E0"
                     Padding="5" SnapsToDevicePixels="True" ColumnHeaderStyle="{StaticResource DataGridColumnHeaderStyle}" CellStyle="{StaticResource DataGridCellStyle}">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="ID" Binding="{Binding ID}" Visibility="Collapsed"/>
                            <DataGridTextColumn Header="Alarm Code" Binding="{Binding Alarm}" Width="*" SortMemberPath="AlarmNumeric"/>
                            <DataGridTextColumn Header="Alarm Description" Binding="{Binding Alarm_Description}" Width="2*" />
                            <DataGridTextColumn Header="Alarm Creation Time" Binding="{Binding RaiseTime, StringFormat=dd MMM yyyy HH:mm:ss}" Width="*" />
                            <DataGridTextColumn Header="Alarm ACK Time" Binding="{Binding AcknowledgeTime,StringFormat=dd MMM yyyy HH:mm:ss}" Width="*" />
                            <DataGridTextColumn Header="Login User" Binding="{Binding Created_by}" Width="*" />
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </TabItem>
            <TabItem Header="Alarm Pie Chart" FontSize="18" Tag="{StaticResource AlarmTabColor}">
                <TabItem.HeaderTemplate>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                            <TextBlock Text="📊"
                           FontSize="16"
                           Foreground="{StaticResource AlarmTabColor}"
                           Margin="0,0,6,0"/>
                            <TextBlock Text="{Binding}" />
                        </StackPanel>
                    </DataTemplate>
                </TabItem.HeaderTemplate>

                <Grid Margin="20">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <TextBlock Text="📊 Alarm Distribution by Alarm Code"
                               FontSize="18"
                               FontWeight="Bold"
                               Foreground="{StaticResource PrimaryColor}"
                               Margin="0 0 0 20" Grid.Row="0"/>

                    <!-- Filters for Pie Chart -->
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,15" Grid.Row="1">
                        <StackPanel Width="150">
                            <TextBlock Text="Start Date" VerticalAlignment="Center" Foreground="{StaticResource PrimaryColor}" FontWeight="Bold" />
                            <DatePicker x:Name="dpPieStartDate" SelectedDateFormat="Short" DisplayDateEnd="{x:Static sys:DateTime.Today}"/>
                        </StackPanel>

                        <StackPanel Width="150" Margin="20,0,0,0">
                            <TextBlock Text="End Date" VerticalAlignment="Center" Foreground="{StaticResource PrimaryColor}" FontWeight="Bold" />
                            <DatePicker x:Name="dpPieEndDate" SelectedDateFormat="Short" DisplayDateEnd="{x:Static sys:DateTime.Today}"/>
                        </StackPanel>

                        <StackPanel Orientation="Horizontal" VerticalAlignment="Bottom" Margin="20,0,0,0">
                            <Button Content="Refresh Chart" Width="120" Click="RefreshPieChart_Click"/>
                        </StackPanel>
                    </StackPanel>

                    <!-- Pie Chart -->
                    <lvc:PieChart x:Name="pieChart"
                                  Grid.Row="2"
                                  LegendLocation="Right"
                                  InnerRadius="0"
                                  HoverPushOut="15">
                        <!--<lvc:PieChart.DataTooltip>
                            <lvc:DefaultTooltip BulletSize="20"/>
                        </lvc:PieChart.DataTooltip>-->
                    </lvc:PieChart>
                </Grid>
            </TabItem>
        </TabControl>
    </Grid>
</UserControl>
